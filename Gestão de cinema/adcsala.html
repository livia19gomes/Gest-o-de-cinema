<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Sala</title>

    <!-- Estilos e √çcones -->
    <link rel="stylesheet" href="assets/css/adicfil.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Scripts de seguran√ßa -->
    <script src="assets/js/seguranca.js" defer></script>
    <script src="assets/js/seguranca-adm.js" defer></script>
</head>

<body>
    <header>
        <img class="logo" src="assets/img/PRIME CINE logo.png" alt="Logo empresarial">
        <div class="div-header">
            <div class="btn-group">
                <button type="button" class="btn btn-secondary dropdown-toggle bg-black border-2" data-bs-toggle="dropdown" aria-expanded="false">
                    MENU
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="promoadm.html">PROMO√á√ïES</a></li>
                    <li><a class="dropdown-item" href="relatorios_adm.html">RELAT√ìRIO</a></li>
                    <li><a class="dropdown-item" href="homeeae.html">HOME</a></li>
                    <li><a class="dropdown-item" href="listagem.html">LISTAGEM</a></li>
                    <li><a class="dropdown-item" href="homeeae.html">ADICIONAR SESS√ÉO</a></li>
                </ul>
            </div>

            <div class="acao">
                <div class="perfil-container">
                    <img onclick="toggleMenu()" class="btn-perfil2" src="assets/img/do-utilizador.png" alt="">
                    <div class="menu-perfil" id="menuPerfil">
                        <p>Ol√°, <span class="nome-veisitante" id="nome-visitante">(Nome do visitante)</span></p>
                        <ul>
                            <li><a href="meusPedidos.html">üì¶ Meus Pedidos</a></li>
                            <li><a href="editar.html">‚úèÔ∏è Editar perfil</a></li>
                            <li><a href="login.html">üö™ Sair da Conta</a></li>
                        </ul>
                    </div>
                </div>
            </div>
    </header>

    <main class="container mt-5">
        <h2>Adicionar Sala</h2>
        <form id="form_cadastro">
            <div class="mb-3">
                <label for="id_sala" class="form-label">Nome da Sala:</label>
                <input type="text" id="id_sala" name="id_sala" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="capacidade" class="form-label">Capacidade:</label>
                <input type="number" id="capacidade" name="capacidade" min="1" max="100" class="form-control" required>
            </div>

            <button type="submit" class="btn-primeiro">Adicionar Sala</button>
        </form>
    </main>

    <script>
        document.getElementById('form_cadastro').addEventListener('submit', function (e) {
            e.preventDefault();

            const descricao = document.getElementById('id_sala').value.trim();
            const capacidade = parseInt(document.getElementById('capacidade').value);

            if (!descricao || isNaN(capacidade)) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Preencha todos os campos!',
                    text: 'Voc√™ precisa informar o nome da sala e a capacidade.'
                });
                return;
            }

            fetch('http://10.92.3.172:5000/salas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    descricao: descricao,
                    capacidade: capacidade
                })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erro HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Erro!',
                            text: data.error
                        });
                    } else {
                        Swal.fire({
                            icon: 'success',
                            title: 'Sala adicionada!',
                            text: data.message
                        });
                        document.getElementById('form_cadastro').reset();
                    }
                })
                .catch(error => {
                    console.error('Erro na requisi√ß√£o:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro de conex√£o!',
                        text: 'N√£o foi poss√≠vel conectar ao servidor.'
                    });
                });
        });
    </script>
</body>

</html>
