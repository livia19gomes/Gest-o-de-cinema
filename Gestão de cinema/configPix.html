<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Pix - Prime Cine</title>
    <link rel="stylesheet" href="assets/css/editar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/seguranca.js" defer></script>
</head>

<body>
    <div class="container">
        <div class="esquerda">
            <a href="homeeae.html">
                <img class="logo" src="assets/img/PRIME CINE logo.png" alt="Logo empresarial">
            </a>
        </div>
        <div class="direita">
            <h2>Configurar Pix:</h2>
            <form id="form_editar">
                <div class="campo">
                    <input type="text" name="razao_social" id="razao_social" placeholder="Edite a razÃ£o social">
                </div>
                <div class="campo">
                    <input type="text" name="nome_fantasia" id="nome_fantasia" placeholder="Edite o nome">
                </div>
                <div class="campo">
                    <input type="text" name="chave_pix" id="chave_pix" placeholder="Edite a chave pix">
                </div>
                <div class="campo">
                    <input type="text" name="cidade" id="cidade" placeholder="Edite a cidade">
                </div>
                <button type="submit" class="botao">SALVAR</button>
            </form>
        </div>
    </div>

    <script>
        function buscarDados() {
            $.ajax({
                method: "GET",
                url: "http://192.168.1.106:5000/configurar-pix",
                contentType: "application/json",
                success: function (retorno) {
                    console.log("Dados recebidos:", retorno);
                    $("#razao_social").val(retorno.usuarios.razao_social);
                    $("#nome_fantasia").val(retorno.usuarios.nome_fantasia);
                    $("#chave_pix").val(retorno.usuarios.chave_pix);
                    $("#cidade").val(retorno.usuarios.cidade);
                },
                error: function (retorno) {
                    console.error("Erro ao carregar dados:", retorno);
                    Swal.fire({
                        icon: "error",
                        title: "Erro!",
                        text: "Erro ao carregar dados de Pix.",
                        confirmButtonText: "OK"
                    });
                }
            });
        }

        function validarFormulario(event) {
            event.preventDefault();

            const dados = {
                razao_social: $("#razao_social").val(),
                nome_fantasia: $("#nome_fantasia").val(),
                chave_pix: $("#chave_pix").val(),
                cidade: $("#cidade").val()
            };

            $.ajax({
                method: "POST",
                url: "http://192.168.1.106:5000/configurar-pix",
                contentType: "application/json",
                data: JSON.stringify(dados),
                success: function (resposta) {
                    Swal.fire({
                        icon: "success",
                        title: "Sucesso!",
                        text: resposta.mensagem || "Dados atualizados com sucesso.",
                        confirmButtonText: "OK"
                    });
                },
                error: function (erro) {
                    console.error("Erro completo:", erro);
                    Swal.fire({
                        icon: "error",
                        title: "Erro!",
                        text: erro.responseJSON?.erro || "Erro ao salvar os dados.",
                        confirmButtonText: "OK"
                    });
                }
            });
        }

        $(document).ready(function () {
            buscarDados();
            $("#form_editar").on("submit", validarFormulario);
        });
    </script>
</body>

</html>
