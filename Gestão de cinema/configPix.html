<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Pix- Prime Cine</title>
    <link rel="stylesheet" href="assets/css/editar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="assets/js/seguranca.js" defer></script>
</head>

<body>
    <div class="container">
        <div class="esquerda">
            <a href="homePoslogin.html"><img class="logo" src="assets/img/PRIME CINE logo.png" alt="Logo empresarial">
            </a>
        </div>
        <div class="direita">
            <h2>Configurar Pix:</h2>
            <form id="form_editar" onsubmit="validarFormulario(event)">
                <div class="campo">
                    <input type="text" name="razao_social" id="razao_social" placeholder="Edite a razão social">
                </div>
                <div class="campo">
                    <input type="text" name="nome_fantasia" id="nome_fantasia" placeholder="Edite o nome">
                </div>
                <span id="erro-telefone" class="erro"></span>
                <div class="campo">
                    <input type="text" name="chave_pix" id="chave_pix" placeholder="Edite a chave pix">
                </div>
                <span id="erro-email" class="erro"></span>
                <div class="campo">
                    <input type="text" name="cidade" id="cidade" placeholder="Edite a cidade">
                </div>
                <button type="submit" class="botao">SALVAR</button>
            </form>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Fazer requisição GET para obter os dados de configuração do Pix
            $.ajax({
                method: "GET",
                url: "http://192.168.1.106:5000/configurar-pix",
                success: function (retorno) {
                    // Preencher os campos com os dados recebidos
                    $("#razao_social").val(retorno.usuarios.razao_social);
                    $("#nome_fantasia").val(retorno.usuarios.nome_fantasia);
                    $("#chave_pix").val(retorno.usuarios.chave_pix);
                    $("#cidade").val(retorno.usuarios.cidade);
                },
                error: function (retorno) {
                    console.error("Erro ao carregar dados:", retorno);
                    Swal.fire({
                        icon: "error",
                        title: "Erro!",
                        text: "Erro ao carregar dados de Pix.",
                        confirmButtonText: "OK"
                    });
                }
            });

            // Lógica para enviar os dados via POST
            $("#form_editar").on("submit", function (e) {
                e.preventDefault();

                let envia = {
                    razao_social: $("#razao_social").val(),
                    nome_fantasia: $("#nome_fantasia").val(),
                    chave_pix: $("#chave_pix").val(),
                    cidade: $("#cidade").val(),
                };

                $.ajax({
                    method: "POST",
                    url: "http://192.168.1.106:5000/configurar-pix",
                    contentType: "application/json",
                    data: JSON.stringify(envia),
                    success: function (retorno) {
                        Swal.fire({
                            icon: "success",
                            title: "Edição Realizada!",
                            text: retorno.mensagem,
                            confirmButtonText: "OK"
                        }).then(() => {
                            // Armazenar os dados no localStorage
                            localStorage.setItem("razao_social", envia.razao_social);
                            localStorage.setItem("nome_fantasia", envia.nome_fantasia);
                            localStorage.setItem("chave_pix", envia.chave_pix);
                            localStorage.setItem("cidade", envia.cidade);

                            window.location.href = "homeeae.html";
                        });
                    },
                    error: function (retorno) {
                        console.error("Erro completo:", retorno);
                        Swal.fire({
                            icon: "error",
                            title: "Erro!",
                            text: retorno.responseJSON?.error || "Deu errado.",
                            confirmButtonText: "OK"
                        });
                    }
                });
            });
        });
    </script>
</body>

</html>
