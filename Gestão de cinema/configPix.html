<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Pix- Prime Cine</title>
    <link rel="stylesheet" href="assets/css/editar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script src="assets/js/seguranca.js" defer></script>


</head>

<body>
    <div class="container">
        <div class="esquerda">
            <a href="homeeae.html"><img class="logo" src="assets/img/PRIME CINE logo.png" alt="Logo empresarial">
            </a>
        </div>
        <div class="direita">
            <h2>Configurar Pix:</h2>
            <form id="form_editar" onsubmit="validarFormulario(event)">
                <div class="campo">
                    <input type="text" name="razao_social" id="razao_social" placeholder="Edite a razão social">
                </div>
                <div class="campo">
                   <input type="text" name="nome_fantasia" id="nome_fantasia" placeholder="Edite o nome">
                </div>
                <span id="erro-telefone" class="erro"></span>
                <div class="campo">
                    <input type="text" name="chave_pix" id="chave_pix" placeholder="Edite a chave pix">
                </div>
                <span id="erro-email" class="erro"></span>
                <div class="campo">
                    <input type="text" name="cidade" id="cidade" placeholder="Edite a cidade">
                </div>
                <button type="submit" class="botao">SALVAR</button>
            </form>
        </div>
    </div>
   <script>

        function buscarDados() {

            $.ajax({
                method: "GET",
                url: "http://192.168.1.111:5000/configurar-pix",
                contentType: "application/json",
                success: function (retorno) {
                    console.log("Dados recebidos:", retorno);
                    document.getElementById("razao_social").value = retorno.usuarios.razao_social
                    document.getElementById("nome_fantasia").value = retorno.usuarios.nome_fantasia
                    document.getElementById("chave_pix").value = retorno.usuarios.chave_pix
                    document.getElementById("cidade").value = retorno.usuarios.cidade
                },
               
                error: function (retorno) {
                    console.error("Erro completo:", retorno);
                    Swal.fire({
                        icon: "error",
                        title: "Erro!",
                        text: retorno.responseJSON?.error || "Deu errado.",
                        confirmButtonText: "OK"
                    });
                }
            });            
     }

     document.addEventListener("DOMContentLoaded", function () {
        buscarDados();
    });

        function validarFormulario(event) {
            event.preventDefault(); // Evita o recarregamento do formulário

            const dados = {
                razao_social: document.getElementById("razao_social").value,
                nome_fantasia: document.getElementById("nome_fantasia").value,
                chave_pix: document.getElementById("chave_pix").value,
                cidade: document.getElementById("cidade").value
            };

            $.ajax({
                method: "POST",
                url: "http://192.168.1.111:5000/configurar-pix",
                contentType: "application/json",
                data: JSON.stringify(dados),
                success: function (resposta) {
                    Swal.fire({
                        icon: "success",
                        title: "Sucesso!",
                        text: resposta.mensagem || "Dados atualizados com sucesso.",
                        confirmButtonText: "OK"
                    });
                },
                error: function (erro) {
                    console.error("Erro completo:", erro);
                    Swal.fire({
                        icon: "error",
                        title: "Erro!",
                        text: erro.responseJSON?.erro || "Erro ao salvar os dados.",
                        confirmButtonText: "OK"
                    });
                }
            });
        }



    
            
            $.ajax({
                method: "post",
                url: "http://192.168.1.111:5000/login",
                data: dados, // envia os dados do formulário
                contentType: "application/json",
                success: function (retorno) { // caso o login de certo

                    document.getElementById("razao_social").value = retorno.usuarios.razao_social
                    document.getElementById("nome_fantasia").value = retorno.usuarios.nome_fantasia
                    document.getElementById("chave_pix").value = retorno.usuarios.chave_pix
                    document.getElementById("cidade").value = retorno.usuarios.cidade


                    Swal.fire({
                        title: "Deu Certo!",
                        icon: "success"
                    }).then(() => {
                        if (retorno.usuarios.tipo === "adm") {
                            window.location.href = "homeeae.html";
                        } else {
                            window.location.href = "homePoslogin.html";
                        }
                    });
                },
                error: function (retorno) { // caso de erro no login
                    Swal.fire({
                        title: "Erro!",
                        text: retorno.responseJSON?.error || "Erro ao tentar fazer login.",
                        icon: "error"
                    });
                }
            });
    </script>
</body>

</html>