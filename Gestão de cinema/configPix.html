<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Pix- Prime Cine</title>
    <link rel="stylesheet" href="assets/css/editar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script src="assets/js/seguranca.js" defer></script>


</head>

<body>
    <div class="container">
        <div class="esquerda">
            <a href="homePoslogin.html"><img class="logo" src="assets/img/PRIME CINE logo.png" alt="Logo empresarial">
            </a>
        </div>
        <div class="direita">
            <h2>Configurar Pix:</h2>
            <form id="form_editar" onsubmit="validarFormulario(event)">
                <div class="campo">
                    <input type="text" name="razao_social" id="razao_social" placeholder="Edite a razão social">
                </div>
                <div class="campo">
                   <input type="text" name="nome_fantasia" id="nome_fantasia" placeholder="Edite o nome">
                </div>
                <span id="erro-telefone" class="erro"></span>
                <div class="campo">
                    <input type="text" name="chave_pix" id="chave_pix" placeholder="Edite a chave pix">
                </div>
                <span id="erro-email" class="erro"></span>
                <div class="campo">
                    <input type="text" name="cidade" id="cidade" placeholder="Edite a cidade">
                </div>
                <button type="submit" class="botao">SALVAR</button>
            </form>
        </div>
    </div>
    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        document.getElementById("razao_social").value = params.get("razao_social");
        document.getElementById("nome_fantasia").value = params.get("nome_fantasia");
        document.getElementById("chave_pix").value = params.get("chave_pix");
        document.getElementById("cidade").value = params.get("cidade");

        $("#form_editar").on("submit", function (e) {
            e.preventDefault();

            let envia = {
                razao_social: $("#razao_social").val(),
                nome_fantasia: $("#nome_fantasia").val(),
                chave_pix: $("#chave_pix").val(),
                cidade: $("#cidade").val(),
            };

            $.ajax({
                method: "POST",
                url: "http://192.168.1.111:5000/configurar-pix",
                contentType: "application/json",
                data: JSON.stringify(envia),
                success: function (retorno) {
                    Swal.fire({
                        icon: "success",
                        title: "Edição Realizada!",
                        text: retorno.message,
                        confirmButtonText: "OK"
                    }).then(() => {
                        localStorage.setItem("razao_social", envia.razao_social);
                        localStorage.setItem("nome_fantasia", envia.nome_fantasia);
                        localStorage.setItem("chave_pix", envia.chave_pix);
                        localStorage.setItem("cidade", envia.cidade);

                        window.location.href = "homeeae.html";
                    });
                },
                error: function (retorno) {
                    console.error("Erro completo:", retorno);
                    Swal.fire({
                        icon: "error",
                        title: "Erro!",
                        text: retorno.responseJSON?.error || "Deu errado.",
                        confirmButtonText: "OK"
                    });
                }
            });
            
            $.ajax({
                method: "post",
                url: "http://192.168.1.111:5000/login",
                data: dados, // envia os dados do formulário
                contentType: "application/json",
                success: function (retorno) { // caso o login de certo

                    document.getElementById("razao_social").value = retorno.usuarios.razao_social
                    document.getElementById("nome_fantasia").value = retorno.usuarios.nome_fantasia
                    document.getElementById("chave_pix").value = retorno.usuarios.chave_pix
                    document.getElementById("cidade").value = retorno.usuarios.cidade


                    Swal.fire({
                        title: "Deu Certo!",
                        icon: "success"
                    }).then(() => {
                        if (retorno.usuarios.tipo === "adm") {
                            window.location.href = "homeeae.html";
                        } else {
                            window.location.href = "homePoslogin.html";
                        }
                    });
                },
                error: function (retorno) { // caso de erro no login
                    Swal.fire({
                        title: "Erro!",
                        text: retorno.responseJSON?.error || "Erro ao tentar fazer login.",
                        icon: "error"
                    });
                }
            });
     });
    </script>
</body>

</html>