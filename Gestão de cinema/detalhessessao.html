<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Detalhes da sessão</title>
  <link rel="stylesheet" href="assets/css/detalhessessao.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <!-- Fundo: página embutida -->
  <iframe src="meusPedidos.html" class="background-iframe"></iframe>

  <!-- Camada sobreposta -->
  <div class="overlay">
    <div class="modal-box">
      <a href="meusPedidos.html" class="close-btn" title="Fechar">
        <i class="fa-solid fa-xmark"></i>
      </a>
      <h1>DETALHES DO SEU PEDIDO</h1>
      <div class="details" id="details">
        <div>
          <p><strong><i class="fa-solid fa-film"></i> Filme:</strong> Moana 2</p>
          <p><strong><i class="fa-solid fa-calendar-days"></i> Data:</strong> 29 de Maio de 2025</p>
          <p><strong><i class="fa-solid fa-clock"></i> Horário:</strong> 14:30</p>
          <p><strong><i class="fa-solid fa-door-open"></i> Sala:</strong> Sala Premium</p>
          <p><strong><i class="fa-solid fa-chair"></i> Assento:</strong> 19, 20</p>
          <p><strong><i class="fa-solid fa-dollar-sign"></i> Valor total:</strong> R$40,00</p>
        </div>
        <div>
          <p>Pague agora pelo pix!</p>
          <p>Escaneie o qrcode abaixo.</p>
          <img id="qrcode-pix" src="" alt="QR Code PIX" class="qrcode">
        </div>
      </div>
    </div>
  </div>

  <script>
  // Função para extrair o ID da reserva da URL
  function getIdReserva() {
    const params = new URLSearchParams(window.location.search);
    return params.get("id_reserva"); // Ex: ?id_reserva=5
  }

  // Carrega o QR Code quando a página estiver pronta
  document.addEventListener("DOMContentLoaded", () => {
    const idReserva = getIdReserva();

    if (idReserva) {
      const qrCodeImg = document.getElementById("qrcode-pix");
      qrCodeImg.src = `http://192.168.1.139:5000/pix_qrcode/${idReserva}`;
    } else {
      console.error("Reserva não encontrada.");
    }
  });
</script>

      function toggleMenu() {
                const menu = document.getElementById("menuPerfil");
                menu.style.display = menu.style.display === "block" ? "none" : "block";
            }

            document.addEventListener('DOMContentLoaded', function () {
                carregarDadosUsuario();
                carregarReservas();
            });

            // Função para carregar dados do usuário da API
            function carregarDadosUsuario() {
                var token = localStorage.getItem("token");

                if (!token) {
                    console.error("Token não encontrado. Usuário não está autenticado.");
                    return;
                }

                var settings = {
                    "url": "http://192.168.1.139:5000/usuarios/perfil",
                    "method": "GET",
                    "timeout": 0,
                    "headers": {
                        "Authorization": token,
                        "Content-Type": "application/json"
                    },
                    "success": function (response) {
                        var nomeUsuario = response.nome || "Visitante";

                        var elementosComNome = document.querySelectorAll(".nome-visitante");
                        elementosComNome.forEach(function (elemento) {
                            elemento.textContent = nomeUsuario;
                        });
                    },
                    "error": function (error) {
                        console.error("Erro ao carregar dados do usuário:", error);
                        var nomeUsuario = localStorage.getItem("nome") || "Visitante";

                        var elementosComNome = document.querySelectorAll(".nome-visitante");
                        elementosComNome.forEach(function (elemento) {
                            elemento.textContent = nomeUsuario;
                        });
                    }
                };

                $.ajax(settings);
            }

            // Função para carregar reservas do usuário da API
            function carregarReservas() {
                var token = localStorage.getItem("token");

                var settings = {
                    "url": "http://192.168.1.139:5000/reservas",
                    "method": "GET",
                    "timeout": 0,
                    "headers": {
                        "Authorization": "Bearer " + token,
                        "Content-Type": "application/json"
                    },
                "success": function (response) {
                    response.reservas.forEach(function (reserva) {
                        document.getElementById("details").innerHTML += `
                           
                            <div>
                                
                                <p><strong><i class="fa-solid fa-film"></i> Filme: </strong>${reserva.titulo_filme}</p>
                                <p><strong><i class="fa-solid fa-calendar-days"></i> Data:</strong> 29 de Maio de 2025</p>
                                <p><strong><i class="fa-solid fa-clock"></i> Horário:</strong> ${reserva.horario}</p>
                                <p><strong><i class="fa-solid fa-door-open"></i> Sala:</strong> ${reserva.sala}</p>
                                <p><strong><i class="fa-solid fa-chair"></i> Assento:</strong> ${reserva.assentos}</p>
                                <p><strong><i class="fa-solid fa-dollar-sign"></i> Valor total:</strong> R$40,00</p>
                            </div>
                            
                        `
                    })
                },
  </script>


</body>
</html>

