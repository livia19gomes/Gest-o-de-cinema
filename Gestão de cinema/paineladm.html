<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Painel Administrativo | PrimeCine</title>
    <link rel="stylesheet" href="assets/css/paineladm.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/seguranca-adm.js" defer></script>
</head>
<body>
    <header class="header">
        <a href="homeeae.html" class="logo-link">
            <img class="logo" src="assets/img/PRIME CINE logo.png" alt="Logo empresarial" />
        </a>

        <div class="div-header">

            <div class="btn-group">
                <button
                    type="button"
                    class="btn btn-secondary dropdown-toggle bg-black border-2"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                >
                    MENU
                </button>
                <ul class="dropdown-menu dropdown-menu-end menu-escuro">
                    <li><a class="dropdown-item" href="promoadm.html">PROMO√á√ïES</a></li>
                    <li><a class="dropdown-item" href="relatorios_adm.html">RELAT√ìRIO</a></li>
                    <li><a class="dropdown-item" href="homeeae.html">HOME</a></li>
                    <li><a class="dropdown-item" href="listagem.html">LISTAGEM</a></li>
                    <li><a class="dropdown-item" href="adicsessao.html">ADICIONAR SESS√ÉO</a></li>
                    <li><a class="dropdown-item" href="adcsala.html">ADICIONAR SALA</a></li>
                    <li><a class="dropdown-item" href="paineladm.html">PAINEL ADMINISTRATIVO</a></li>
                    <li><a class="dropdown-item" href="configPix.html">CONFIGURAR PIX</a></li>
                </ul>
            </div>

            <div class="acao">
                <div class="perfil-container">
                    <img onclick="toggleMenu()" class="btn-perfil2" src="assets/img/do-utilizador.png" alt="Perfil" />
                    <div class="menu-perfil" id="menuPerfil">
                        <p>Ol√°, <span class="nome-veisitante" id="nome-visitante">(Nome do visitante)</span></p>
                        <ul>
                            <li><a href="meusPedidos.html">üì¶ Meus Pedidos</a></li>
                            <li><a href="editaradm.html">‚úèÔ∏è Editar perfil</a></li>
                            <li><a href="login.html" onclick="sair()">üö™ Sair da Conta</a></li>z
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

       <main class="dashboard-container">
    <h1 class="tt">Painel Administrativo</h1>

    <section class="cards">
      <div class="card">
        <div class="card-content">
          <h2>R$ 45.320,00</h2>
          <p>Valor Arrecadado</p>
          <button id="openModal">Filtrar por data</button>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <h2>1.230</h2>
          <p>Ingressos Vendidos</p>
        </div>
      </div>

      <div class="card">
        <div class="card-content">
          <h2>Top Bilheteria</h2>
          <ul>
            <li>1. Filme A ‚Äì R$ 12.000</li>
            <li>2. Filme B ‚Äì R$ 9.800</li>
            <li>3. Filme C ‚Äì R$ 7.500</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="tabela-sessoes">
      <div class="tabela-header">
        <h2>Vendas por Sess√£o</h2>
        <button>Ver todas</button
            >
      </div>
      <table>
        <thead>
          <tr>
            <th>Hor√°rio</th>
            <th>Filme</th>
            <th>Ingressos</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>14h</td>
            <td>Filme A</td>
            <td>150</td>
          </tr>
          <tr>
            <td>17h</td>
            <td>Filme B</td>
            <td>230</td>
          </tr>
          <tr>
            <td>20h</td>
            <td>Filme C</td>
            <td>310</td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>



    <footer class="main_footer_container">
        <div class="content">
            <div class="colfooter">
                <h3 class="titleFooter">Menu</h3>
                <ul>
                    <li><a href="homeeae.html" title="P√°gina In√≠cial">P√°gina In√≠cial</a></li>
                    <li><a href="promo√ß√µes.html" title="Promo√ß√µes">Promo√ß√µes</a></li>
                    <li><a href="relatorios.html" title="Relat√≥rio">Relat√≥rio</a></li>
                    <li><a href="cadastro.html" title="Cadastro">Cadastro</a></li>
                </ul>
            </div>
            <div class="colfooter">
                <h3 class="titleFooter">Contato</h3>
                <p><i class="icon icon-mail"></i> primecine@gmail.com</p>
                <p><i class="icon icon-phone"></i> (00) 00000-0000</p>
                <p><i class="icon icon-whatsapp"></i> (11) 11111-1111</p>
            </div>
            <div class="colfooter">
                <h3 class="titleFooter">Redes Sociais</h3>
                <div class="redes-sociais">
                    <a class="rss" href="https://www.instagram.com/">
                        <img src="assets/img/instagram.png" alt="Instagram" />
                    </a>
                    <a class="rss" href="https://www.whatsapp.com/?lang=pt_BR">
                        <img src="assets/img/whatsapp (1).png" alt="WhatsApp" />
                    </a>
                    <a class="rss" href="https://x.com/?lang=pt">
                        <img src="assets/img/twitter.png" alt="Twitter" />
                    </a>
                    <a class="rss" href="https://www.facebook.com/?locale=pt_BR">
                        <img src="assets/img/facebook.png" alt="Facebook" />
                    </a>
                </div>
            </div>
        </div>
        
        <div class="main_footer_copy">
            <p class="m-b-footer">PrimeCine - 2025 ¬© todos os direitos reservados</p>
        </div>
    </footer>

    <script>
    const openModal = document.getElementById('openModal');
    const closeModal = document.getElementById('closeModal');
    const modal = document.getElementById('modal');

    openModal.addEventListener('click', () => {
      modal.style.display = 'flex';
    });

    closeModal.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    window.onclick = function (event) {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    };
  </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleMenu() {
            const menu = document.getElementById("menuPerfil");
            menu.classList.toggle("show");
        }

        function sair() {
            Swal.fire({
                title: "Tem certeza que deseja sair?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Sim, sair",
                cancelButtonText: "Cancelar",
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem("token");
                    localStorage.removeItem("nome");
                    Swal.fire({
                        title: "Sess√£o finalizada!",
                        icon: "success",
                        showConfirmButton: false,
                        timer: 1500,
                    }).then(() => {
                        window.location.href = "login.html";
                    });
                }
            });
        }

        document.addEventListener("click", function (event) {
            const botaoPerfil = document.querySelector(".perfil-container");
            const menu = document.getElementById("menuPerfil");

            if (!botaoPerfil.contains(event.target) && !menu.contains(event.target)) {
                menu.classList.remove("show");
            }
        });

        var nome = localStorage.getItem("nome");
        if (nome) {
            document.getElementById("nome-visitante").textContent = nome;
        }

        async function buscarDadosDoBackend() {
       
            const url = "/api/painel-dados"; 

            try {
                const resposta = await fetch(url);
                if (!resposta.ok) throw new Error("Erro ao carregar dados");
                const dados = await resposta.json();
                return dados;
            } catch (erro) {
                console.error(erro);
                return null;
            }
        }


        function atualizarDadosPainel(dados) {
            if (!dados) return;

         
            const valor = dados.totalArrecadado;
            document.getElementById("valor-arrecadado").textContent = valor
                ? valor.toLocaleString("pt-BR", {
                      style: "currency",
                      currency: "BRL",
                  })
                : "";

        
            document.getElementById("ingressos-vendidos").textContent = dados.ingressosVendidos ?? "";

         
            const ranking = document.getElementById("ranking-filmes");
            ranking.innerHTML = ""; 

            if (Array.isArray(dados.filmes)) {
                dados.filmes.forEach((filme, i) => {
                    const div = document.createElement("div");
                    div.classList.add("filme-rank");
                    div.innerHTML = `
                        <span class="posicao">${i + 1}¬∫</span>
                        <span class="filme-nome">${filme.nome}</span>
                        <span class="bilheteria">${filme.bilheteria.toLocaleString("pt-BR", {
                            style: "currency",
                            currency: "BRL",
                        })}</span>
                    `;
                    ranking.appendChild(div);
                });
            }

  
            const vendasSessoes = document.getElementById("vendas-sessoes");
            vendasSessoes.innerHTML = ""; 

            if (Array.isArray(dados.vendasSessoes)) {
                dados.vendasSessoes.forEach((sessao) => {
                    const div = document.createElement("div");
                    div.classList.add("sessao-item");
                    div.innerHTML = `
                        <span class="filme-nome">${sessao.nomeFilme}</span>
                        <span class="sessao-hora">${sessao.sessao}: ${sessao.ingressos} ingressos</span>
                    `;
                    vendasSessoes.appendChild(div);
                });
            }
        }

   
        window.addEventListener("DOMContentLoaded", async () => {
            const dados = await buscarDadosDoBackend();
            atualizarDadosPainel(dados);
        });
    </script>
</body>
</html>

            


